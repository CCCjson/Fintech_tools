# 已知问题汇总

## 问题列表

### 问题1: 前端页面无法显示 ✅ 已解决

**问题描述**: 运行 `python run.py` 后前端页面无法打开

**原因**:
- 缺少Python依赖包（flask、flask-cors、apscheduler）
- 前端服务未启动
- 前端依赖损坏

**解决方案**:
详见: `doc/前端修复说明.md`

**修复状态**: ✅ 已解决
**修复时间**: 2025-11-04

---

### 问题2: 前端显示但无数据 ⏳ 待修复

**问题描述**: 前端页面能正常显示，但所有列表都是空的，没有任何数据

**原因**:
- **数据库为空**: 系统启动后数据库中没有数据
- **定时任务未触发**: 定时任务按时间计划执行，当前非交易时间
- **缺少初始化**: 系统没有自动初始化数据的机制

**数据库状态**:
```
股票数量: 0
行业数量: 0
日线数据: 0
```

**解决方案**:
详见: `doc/快速修复数据问题.md` 或 `doc/数据无法显示问题分析.md`

**快速修复**:
```bash
# 步骤1: 更新股票数据
python -c "from src.tasks.daily_tasks import update_stock_list; update_stock_list()"

# 步骤2: 更新行业数据
python -c "from src.tasks.daily_tasks import update_industry_data; update_industry_data()"

# 步骤3: 刷新浏览器
```

**修复状态**: ⏳ 待用户执行
**预计时间**: 5分钟

---

## 部署检查清单

在首次部署或重新部署时，请按以下顺序检查：

### 1. 环境检查
- [ ] Python 3.9+ 已安装
- [ ] Node.js 16+ 已安装
- [ ] pip 已安装
- [ ] npm 已安装

### 2. 依赖安装
- [ ] Python依赖已安装 (`pip install -r requirements.txt`)
- [ ] 前端依赖已安装 (`cd frontend && npm install`)
- [ ] Tushare已安装 (`pip list | grep tushare`)

### 3. 配置检查
- [ ] `config/config.yaml` 中Tushare token已配置
- [ ] 数据库目录存在 (`data/database/`)
- [ ] 日志目录存在 (`logs/`)

### 4. 服务启动
- [ ] 后端服务正常启动 (`python run.py`)
- [ ] 前端服务正常启动 (`cd frontend && npm run dev`)
- [ ] 后端可访问 (`curl http://localhost:5000/health`)
- [ ] 前端可访问 (`curl http://localhost:3000`)

### 5. 数据初始化 ⚠️ 重要
- [ ] 执行股票数据更新
- [ ] 执行行业数据更新
- [ ] 验证数据已导入
- [ ] 前端页面有数据显示

### 6. 功能验证
- [ ] 股票列表页面有数据
- [ ] 行业分析页面有数据
- [ ] API接口正常返回
- [ ] 定时任务正常调度

## 常见错误处理

### 错误1: ModuleNotFoundError

**错误信息**: `ModuleNotFoundError: No module named 'xxx'`

**原因**: 缺少Python依赖包

**解决**:
```bash
pip install -r requirements.txt
```

### 错误2: Permission denied

**错误信息**: `sh: 1: vite: Permission denied`

**原因**: node_modules权限或损坏

**解决**:
```bash
cd frontend
rm -rf node_modules package-lock.json
npm install
```

### 错误3: Port already in use

**错误信息**: `Address already in use`

**原因**: 端口被占用

**解决**:
```bash
# 查找占用进程
lsof -i :5000  # 后端
lsof -i :3000  # 前端

# 杀死进程
kill -9 <PID>
```

### 错误4: CORS error

**错误信息**: 浏览器控制台显示CORS错误

**原因**: 跨域配置问题

**解决**:
检查 `config/config.yaml` 中的CORS配置是否包含前端地址：
```yaml
api:
  cors_origins:
    - "http://localhost:3000"
    - "http://localhost:5173"
```

### 错误5: Tushare token invalid

**错误信息**: `Tushare token未配置` 或 `权限不足`

**原因**: Token配置错误或失效

**解决**:
1. 检查 `config/config.yaml` 中的token
2. 访问 https://tushare.pro 确认token状态
3. 重新配置token

## 性能问题

### 问题: 数据更新很慢

**现象**: 执行数据更新需要很长时间

**原因**:
- Tushare接口限制（200次/分钟）
- 网络延迟
- 数据量大（5000+股票）

**解决**:
- 正常现象，首次导入需要1-2分钟
- 确保网络稳定
- 后续增量更新会很快

### 问题: 前端页面加载慢

**现象**: 打开前端页面需要很长时间

**原因**:
- 数据量大，一次性加载太多数据
- 未做分页
- 未做缓存

**解决**:
- API已支持分页参数
- 前端组件使用虚拟滚动
- 添加前端缓存策略

## 待优化项目

### 高优先级
1. ⏳ **添加数据初始化脚本** - 避免手动执行命令
2. ⏳ **完善启动文档** - 明确首次启动流程
3. ⏳ **添加健康检查** - 自动检测数据库状态

### 中优先级
4. ⏳ **前端空数据提示** - 友好的用户体验
5. ⏳ **API错误处理** - 更详细的错误信息
6. ⏳ **日志优化** - 更清晰的日志结构

### 低优先级
7. ⏳ **性能优化** - 数据缓存、分页优化
8. ⏳ **监控告警** - 数据更新失败告警
9. ⏳ **自动化测试** - 端到端测试

## 文档索引

### 修复文档
- [前端修复说明](./前端修复说明.md)
- [数据无法显示问题分析](./数据无法显示问题分析.md)
- [快速修复数据问题](./快速修复数据问题.md)

### 设计文档
- [Tushare替换爬虫设计方案](./Tushare替换爬虫设计方案.md)
- [迁移完成说明](./迁移完成说明.md)

### 使用文档
- [README](../README.md)
- [快速开始](../QUICKSTART.md)

## 获取帮助

### 日志位置
- 应用日志: `logs/app_*.log`
- 错误日志: `logs/error_*.log`

### 调试命令
```bash
# 检查服务状态
curl http://localhost:5000/health
curl http://localhost:3000

# 检查数据库
sqlite3 data/database/stocks.db ".tables"
sqlite3 data/database/stocks.db "SELECT COUNT(*) FROM stocks;"

# 检查Python环境
python -c "from src.data_source.tushare_api import TushareClient; print('OK')"

# 查看日志
tail -f logs/app_*.log
```

---

**文档版本**: v1.0
**最后更新**: 2025-11-04
**维护者**: 系统管理员
