# 文件清理清单

## 清理目标
移除所有数据库、爬虫、定时任务相关的文件，保留Tushare数据源和前端界面。

## 执行前准备

### 1. 备份当前代码
```bash
cd /home/bestfunc/code/code_win/Android
tar -czf tools.md_backup_$(date +%Y%m%d_%H%M%S).tar.gz tools.md/
ls -lh tools.md_backup_*.tar.gz
```

### 2. 停止所有服务
```bash
cd tools.md
pkill -f "python run.py"
pkill -f "vite"
```

## 清理清单

### 第一部分：数据库相关文件 ❌ 完全删除

```bash
# 1. 删除数据模型目录
rm -rf src/models/

# 2. 删除数据库文件
rm -rf data/database/

# 3. 删除数据初始化脚本
rm init_data.py
```

**删除的文件列表**:
```
src/models/__init__.py
src/models/database.py          # 数据库连接配置
src/models/stock.py             # 股票数据模型
src/models/financial.py         # 财务数据模型
src/models/industry.py          # 行业数据模型
src/models/valuation.py         # 估值数据模型

data/database/stocks.db         # SQLite数据库文件

init_data.py                    # 数据初始化脚本
```

### 第二部分：爬虫相关文件 ❌ 完全删除

```bash
# 1. 删除爬虫目录
rm -rf src/crawler/

# 2. 删除爬虫测试
rm tests/test_crawler.py
```

**删除的文件列表**:
```
src/crawler/__init__.py
src/crawler/base_crawler.py        # 爬虫基类
src/crawler/enhanced_crawler.py    # 增强爬虫
src/crawler/industry_crawler.py    # 行业爬虫
src/crawler/stock_list_crawler.py  # 股票列表爬虫
src/crawler/stock_detail_crawler.py # 股票详情爬虫
src/crawler/utils.py               # 爬虫工具函数

tests/test_crawler.py              # 爬虫测试文件
```

### 第三部分：定时任务相关文件 ❌ 完全删除

```bash
# 删除定时任务目录
rm -rf src/tasks/
```

**删除的文件列表**:
```
src/tasks/__init__.py
src/tasks/scheduler.py          # 任务调度器
src/tasks/daily_tasks.py        # 日常更新任务
```

### 第四部分：临时和测试文件 ⚠️ 可选删除

```bash
# 1. 删除测试脚本
rm test_tushare.py

# 2. 清空日志文件
rm -rf logs/*.log

# 3. 删除Python缓存
find . -name "*.pyc" -delete
find . -name "__pycache__" -type d -exec rm -rf {} + 2>/dev/null

# 4. 删除系统文件
find . -name ".DS_Store" -delete
```

**删除的文件列表**:
```
test_tushare.py                 # Tushare功能测试脚本
logs/app_*.log                  # 应用日志
logs/error_*.log                # 错误日志
**/__pycache__/                 # Python缓存目录
**/*.pyc                        # Python编译文件
**/.DS_Store                    # macOS系统文件
```

### 第五部分：不必要的文档 ⚠️ 可选删除

```bash
# 删除旧文档
rm doc/程序设计文稿.md
rm PROXY_GUIDE.md
rm TEST_RESULTS.md
rm QUICKSTART.md
rm PROJECT_SUMMARY.md
rm FINAL_SUMMARY.md
```

**删除的文件列表**:
```
doc/程序设计文稿.md             # 旧设计文档
PROXY_GUIDE.md                  # 代理配置指南（爬虫相关）
TEST_RESULTS.md                 # 爬虫测试结果
QUICKSTART.md                   # 快速开始（已过时）
PROJECT_SUMMARY.md              # 项目总结（已过时）
FINAL_SUMMARY.md                # 最终总结（已过时）
```

### 第六部分：前端无用文件 ⚠️ 可选清理

```bash
cd frontend

# 清理node_modules（可重新安装）
# rm -rf node_modules package-lock.json
# npm install

# 删除构建产物（如果有）
rm -rf dist/
```

## 保留的文件结构

执行清理后，保留的目录结构：

```
tools.md/
├── config/
│   ├── config.yaml              # 配置文件 ✓
│   └── proxies.txt              # (可删除)
├── doc/
│   ├── README.md                # (待创建)
│   ├── 无数据库架构重构设计方案.md
│   ├── 文件清理清单.md
│   └── 代码修改指南.md
├── frontend/                    # 前端代码 ✓
│   ├── src/
│   ├── public/
│   ├── index.html
│   ├── package.json
│   └── vite.config.js
├── src/
│   ├── analysis/                # 分析模块 ✓
│   ├── api/                     # API接口 ✓
│   ├── data_source/             # 数据源 ✓
│   └── utils/                   # 工具函数 ✓
├── tests/
│   └── test_simple.py           # 简单测试 ✓
├── LICENSE                      # 许可证 ✓
├── README.md                    # 项目说明 ✓
├── requirements.txt             # Python依赖 ✓
├── run.py                       # 启动文件 ✓
├── start.sh                     # 启动脚本 ✓
└── stop.sh                      # 停止脚本 ✓
```

## 完整清理脚本

创建并执行清理脚本：

```bash
cd /home/bestfunc/code/code_win/Android/tools.md

# 创建清理脚本
cat > cleanup.sh << 'EOF'
#!/bin/bash

echo "========================================"
echo "开始清理不必要的文件..."
echo "========================================"

# 计数器
deleted_count=0

# 第一部分：数据库相关
echo ""
echo "1. 删除数据库相关文件..."
rm -rf src/models/ && ((deleted_count++)) && echo "  ✓ 删除 src/models/"
rm -rf data/database/ && ((deleted_count++)) && echo "  ✓ 删除 data/database/"
rm -f init_data.py && ((deleted_count++)) && echo "  ✓ 删除 init_data.py"

# 第二部分：爬虫相关
echo ""
echo "2. 删除爬虫相关文件..."
rm -rf src/crawler/ && ((deleted_count++)) && echo "  ✓ 删除 src/crawler/"
rm -f tests/test_crawler.py && ((deleted_count++)) && echo "  ✓ 删除 tests/test_crawler.py"

# 第三部分：定时任务
echo ""
echo "3. 删除定时任务文件..."
rm -rf src/tasks/ && ((deleted_count++)) && echo "  ✓ 删除 src/tasks/"

# 第四部分：临时文件
echo ""
echo "4. 清理临时文件..."
rm -f test_tushare.py && echo "  ✓ 删除 test_tushare.py"
rm -f logs/*.log && echo "  ✓ 清空日志文件"
find . -name "*.pyc" -delete && echo "  ✓ 删除 .pyc 文件"
find . -name "__pycache__" -type d -exec rm -rf {} + 2>/dev/null && echo "  ✓ 删除 __pycache__"
find . -name ".DS_Store" -delete && echo "  ✓ 删除 .DS_Store"

# 第五部分：旧文档
echo ""
echo "5. 删除过时文档..."
rm -f doc/程序设计文稿.md PROXY_GUIDE.md TEST_RESULTS.md && echo "  ✓ 删除旧文档"
rm -f QUICKSTART.md PROJECT_SUMMARY.md FINAL_SUMMARY.md && echo "  ✓ 删除过时文档"

echo ""
echo "========================================"
echo "清理完成！"
echo "========================================"
echo "已删除的主要项目: $deleted_count 个"
echo ""
echo "提示："
echo "- 原代码已备份为 tools.md_backup_*.tar.gz"
echo "- 如需回滚，解压备份文件即可"
echo ""
EOF

# 执行清理
chmod +x cleanup.sh
./cleanup.sh
```

## 验证清理结果

### 1. 检查目录结构
```bash
tree -L 2 -I 'node_modules|__pycache__|*.pyc'
```

### 2. 检查文件大小
```bash
du -sh src/
du -sh data/
du -sh .
```

### 3. 检查Python导入
```bash
python -c "
import sys
sys.path.append('.')
try:
    from src.models import Stock
    print('❌ models 目录未删除')
except ImportError:
    print('✓ models 目录已删除')

try:
    from src.crawler import BaseCrawler
    print('❌ crawler 目录未删除')
except ImportError:
    print('✓ crawler 目录已删除')

try:
    from src.tasks import scheduler
    print('❌ tasks 目录未删除')
except ImportError:
    print('✓ tasks 目录已删除')
"
```

## 预期结果

### 清理前
```
总大小: ~253MB
文件数: ~15000+
目录数: ~3000+
```

### 清理后
```
总大小: ~252MB
文件数: ~14500
目录数: ~2900
主要代码: 减少 ~40%
```

## 回滚方法

如果需要恢复：

```bash
cd /home/bestfunc/code/code_win/Android
rm -rf tools.md
tar -xzf tools.md_backup_YYYYMMDD_HHMMSS.tar.gz
```

## 注意事项

⚠️ **重要提示**:

1. **先备份**: 必须先执行备份再清理
2. **停止服务**: 清理前停止所有运行的服务
3. **验证清理**: 清理后运行验证脚本
4. **保留备份**: 备份文件至少保留1周

✅ **清理后需要做**:

1. 修改 `requirements.txt` 移除不需要的依赖
2. 修改 `src/api/` 中的代码移除数据库引用
3. 修改 `run.py` 移除定时任务
4. 测试系统功能是否正常

---

**文档版本**: v1.0
**创建时间**: 2025-11-04
**适用场景**: 架构重构 - 移除数据库改为直接调用Tushare
