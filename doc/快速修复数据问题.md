# 快速修复数据显示问题

## 问题现象
✅ 前端页面正常显示
❌ 页面上没有任何数据（所有列表为空）

## 问题原因
**数据库为空** - 系统刚启动，数据库中还没有任何股票和行业数据。

定时任务要等到交易日才会自动执行，现在需要**手动触发一次数据更新**。

## 快速修复（5分钟）

### 步骤1: 进入项目目录
```bash
cd /home/bestfunc/code/code_win/Android/tools.md
```

### 步骤2: 更新股票数据
```bash
python -c "from src.tasks.daily_tasks import update_stock_list; update_stock_list()"
```
**等待时间**: 约1-2分钟
**预期结果**: 获取5000+只股票数据

### 步骤3: 更新行业数据
```bash
python -c "from src.tasks.daily_tasks import update_industry_data; update_industry_data()"
```
**等待时间**: 约10-20秒
**预期结果**: 获取31个行业数据

### 步骤4: 验证数据
```bash
sqlite3 data/database/stocks.db "SELECT COUNT(*) FROM stocks; SELECT COUNT(*) FROM industries;"
```
**预期输出**:
```
5445    (股票数量)
31      (行业数量)
```

### 步骤5: 刷新前端页面
在浏览器中刷新 http://localhost:3000

**预期结果**:
- ✅ 股票列表有数据
- ✅ 行业数据显示
- ✅ 图表正常工作

## 如果出现问题

### 问题1: 命令执行报错
**检查Python环境**:
```bash
python -c "import tushare; print('Tushare已安装')"
```

**检查Token配置**:
```bash
python -c "from src.data_source.tushare_api import TushareClient; TushareClient(); print('Token有效')"
```

### 问题2: 数据仍然为空
**查看日志**:
```bash
tail -f logs/app_*.log
```

**重新执行数据更新**:
- 确认网络连接正常
- 确认Tushare服务可访问
- 查看日志中的错误信息

### 问题3: 前端页面仍无数据
**清除浏览器缓存**:
- Chrome: Ctrl+Shift+Delete
- 或使用无痕模式访问

**检查API**:
```bash
curl http://localhost:5000/api/v1/stocks
```
应该返回股票数据（JSON格式）

## 一键修复脚本

创建 `init_data.sh`:
```bash
#!/bin/bash
echo "开始初始化数据..."
python -c "from src.tasks.daily_tasks import update_stock_list; update_stock_list()"
python -c "from src.tasks.daily_tasks import update_industry_data; update_industry_data()"
echo "数据初始化完成！"
sqlite3 data/database/stocks.db "SELECT '股票数量:', COUNT(*) FROM stocks; SELECT '行业数量:', COUNT(*) FROM industries;"
```

**使用方法**:
```bash
chmod +x init_data.sh
./init_data.sh
```

## 执行效果预览

### 更新股票数据时的输出
```
开始获取股票列表，市场: 全部
获取股票列表成功，共5445条
成功更新 5445 条股票基本信息
获取日线行情成功，共5445条
成功更新 5445 条日行情数据
```

### 更新行业数据时的输出
```
开始获取行业数据，日期: 2025-11-04
获取申万一级行业，共31个
成功更新 31 条行业数据
```

## 后续说明

### 自动更新
数据初始化后，系统会按以下计划自动更新：
- **交易日15:30**: 更新全天数据
- **每小时**: 更新行业数据
- **交易时间每分钟**: 更新实时行情

### 手动更新
任何时候都可以重新执行上述命令来更新数据。

---

**问题级别**: 🟡 中等（影响使用但容易修复）
**修复难度**: 🟢 简单（2条命令）
**预计时间**: ⏱️ 5分钟
